Run python backtest.py
======================================================================
üöÄ BACKTEST 4H - OTIMIZA√á√ÉO MASSIVA üöÄ
======================================================================

Baixando dados 4H...
Baixando dados da MEXC...
  Buscando ~10950 candles em 11 requests...
  MEXC falhou: 12 columns passed, passed data had 8 columns
Baixando dados da Binance...
  Erro ao baixar chunk 0: 451 Client Error:  for url: https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=4h&limit=1000&endTime=1769957550512
Baixando dados do CryptoCompare...
‚úÖ CryptoCompare: 4001 candles de 2025-08-17 23:00:00 at√© 2026-02-01 14:00:00
‚úÖ Dados 4H carregados!


================================================================================
üöÄ OTIMIZA√á√ÉO MASSIVA 4H - BUSCANDO A CONFIGURA√á√ÉO VENCEDORA üöÄ
================================================================================

Fatores testados:
  ‚úì Body %: 0, 20, 30, 40, 50, 60
  ‚úì Candle Size: 0, 0.8, 1.0, 1.2, 1.5, 1.8, 2.0, 2.5
  ‚úì Take Profit: 0 (sem), 1.0, 1.2, 1.5, 1.8, 2.0, 2.5, 3.0
  ‚úì Exit First Profit: Sim/N√£o
  ‚úì Exit on MA Turn: Sim/N√£o

üìä Total de combina√ß√µes poss√≠veis: 1536
‚è±Ô∏è  Tempo estimado: ~7.7 minutos


‚úÖ Otimiza√ß√£o conclu√≠da!
   Testadas: 1536 combina√ß√µes
   V√°lidas: 395 (com 20+ trades)

====================================================================================================
üí∞ TOP 20 - M√ÅXIMO RETORNO ABSOLUTO
====================================================================================================
#   Body%  Size  Exit         Trades  WR%     Exp%    Ret%       PF    DD%     Sig 
----------------------------------------------------------------------------------------------------
1   0      0.0   FirstProfit  261     66.3    0.06    16.69      1.35  -4.80   ‚úÖ   
2   20     0.0   FirstProfit  226     68.6    0.07    16.34      1.40  -4.89   ‚úÖ   
3   40     0.0   FirstProfit  192     69.8    0.08    15.21      1.43  -6.15   ‚úÖ   
4   0      1.2   FirstProfit  82      74.4    0.16    14.12      1.81  -4.52   ‚úÖ   
5   30     0.0   FirstProfit  215     68.8    0.06    13.99      1.35  -5.55   ‚úÖ   
6   20     1.2   FirstProfit  74      74.3    0.17    13.51      1.85  -4.84   ‚úÖ   
7   20     0.8   FirstProfit  138     69.6    0.09    13.33      1.43  -5.99   ‚úÖ   
8   0      1.0   FirstProfit  106     72.6    0.12    12.98      1.56  -4.52   ‚úÖ   
9   0      0.8   FirstProfit  156     68.6    0.08    12.59      1.36  -5.74   ‚úÖ   
10  30     0.8   FirstProfit  133     69.9    0.09    12.45      1.42  -6.17   ‚úÖ   
11  20     1.0   FirstProfit  96      71.9    0.12    12.24      1.57  -5.18   ‚úÖ   
12  50     0.0   FirstProfit  167     70.1    0.07    11.45      1.35  -5.88   ‚úÖ   
13  40     0.8   FirstProfit  123     72.4    0.09    11.18      1.43  -5.73   ‚úÖ   
14  60     1.5   TP2.5x       30      30.0    0.39    11.06      1.40  -9.22   ‚ö†Ô∏è  
15  0      1.5   TP2.5x       38      28.9    0.29    10.16      1.31  -8.99   ‚ö†Ô∏è  
16  30     1.2   FirstProfit  71      74.6    0.14    9.94       1.66  -4.84   ‚úÖ   
17  30     1.0   FirstProfit  93      72.0    0.10    9.47       1.47  -5.30   ‚úÖ   
18  0      1.2   TP2.5x       48      27.1    0.21    9.28       1.25  -10.83  ‚ö†Ô∏è  
19  40     1.0   FirstProfit  89      71.9    0.10    8.99       1.46  -5.30   ‚úÖ   
20  40     1.2   FirstProfit  69      73.9    0.13    8.89       1.59  -4.84   ‚úÖ   

====================================================================================================
üìà TOP 20 - M√ÅXIMA EXPECT√ÇNCIA POR TRADE
====================================================================================================
#   Body%  Size  Exit         Trades  WR%     Exp%    Ret%       PF    DD%     Sig 
----------------------------------------------------------------------------------------------------
1   60     1.5   TP2.5x       30      30.0    0.39    11.06      1.40  -9.22   ‚ö†Ô∏è  
2   30     2.0   TP1.8x       23      39.1    0.31    6.77       1.38  -8.00   ‚ö†Ô∏è  
3   20     2.0   TP1.8x       23      39.1    0.31    6.77       1.38  -8.00   ‚ö†Ô∏è  
4   40     2.0   TP1.8x       23      39.1    0.31    6.77       1.38  -8.00   ‚ö†Ô∏è  
5   0      1.5   TP2.5x       38      28.9    0.29    10.16      1.31  -8.99   ‚ö†Ô∏è  
6   40     2.0   TP2.5x       21      28.6    0.28    5.16       1.25  -8.85   ‚ö†Ô∏è  
7   20     2.0   TP2.5x       21      28.6    0.28    5.16       1.25  -8.85   ‚ö†Ô∏è  
8   30     2.0   TP2.5x       21      28.6    0.28    5.16       1.25  -8.85   ‚ö†Ô∏è  
9   40     1.5   TP2.5x       36      27.8    0.25    8.30       1.26  -8.92   ‚ö†Ô∏è  
10  30     1.5   TP2.5x       36      27.8    0.25    8.30       1.26  -8.92   ‚ö†Ô∏è  
11  20     1.5   TP2.5x       36      27.8    0.25    8.22       1.26  -8.99   ‚ö†Ô∏è  
12  50     1.5   TP2.5x       36      27.8    0.25    8.20       1.26  -8.92   ‚ö†Ô∏è  
13  20     2.0   TP1.5x       24      45.8    0.23    5.36       1.31  -7.27   ‚ö†Ô∏è  
14  30     2.0   TP1.5x       24      45.8    0.23    5.36       1.31  -7.27   ‚ö†Ô∏è  
15  40     2.0   TP1.5x       24      45.8    0.23    5.36       1.31  -7.27   ‚ö†Ô∏è  
16  0      2.0   TP1.8x       25      36.0    0.23    5.24       1.28  -8.00   ‚ö†Ô∏è  
17  20     1.5   TP1.8x       40      37.5    0.21    7.94       1.27  -7.65   ‚ö†Ô∏è  
18  0      1.2   TP2.5x       48      27.1    0.21    9.28       1.25  -10.83  ‚ö†Ô∏è  
19  60     1.2   TP2.5x       37      24.3    0.20    6.61       1.21  -10.69  ‚ö†Ô∏è  
20  0      1.5   TP1.8x       43      37.2    0.20    8.21       1.27  -7.95   ‚ö†Ô∏è  

====================================================================================================
üèÜ TOP 20 - M√ÅXIMO WIN RATE
====================================================================================================
#   Body%  Size  Exit         Trades  WR%     Exp%    Ret%       PF    DD%     Sig 
----------------------------------------------------------------------------------------------------
1   30     1.8   FirstProfit  38      76.3    0.10    3.78       1.45  -3.82   ‚úÖ   
2   20     1.8   FirstProfit  38      76.3    0.10    3.78       1.45  -3.82   ‚úÖ   
3   40     1.8   FirstProfit  38      76.3    0.10    3.78       1.45  -3.82   ‚úÖ   
4   50     1.8   FirstProfit  36      75.0    0.09    3.26       1.39  -3.82   ‚úÖ   
5   30     1.2   FirstProfit  71      74.6    0.14    9.94       1.66  -4.84   ‚úÖ   
6   0      1.2   FirstProfit  82      74.4    0.16    14.12      1.81  -4.52   ‚úÖ   
7   20     1.2   FirstProfit  74      74.3    0.17    13.51      1.85  -4.84   ‚úÖ   
8   20     2.0   FirstProfit  31      74.2    0.08    2.50       1.33  -3.82   ‚úÖ   
9   30     2.0   FirstProfit  31      74.2    0.08    2.50       1.33  -3.82   ‚úÖ   
10  40     2.0   FirstProfit  31      74.2    0.08    2.50       1.33  -3.82   ‚úÖ   
11  20     1.5   FirstProfit  54      74.1    0.08    4.28       1.31  -6.18   ‚úÖ   
12  60     1.2   FirstProfit  54      74.1    0.11    5.97       1.52  -4.14   ‚úÖ   
13  40     1.2   FirstProfit  69      73.9    0.13    8.89       1.59  -4.84   ‚úÖ   
14  0      1.8   FirstProfit  42      73.8    0.07    3.03       1.31  -3.82   ‚úÖ   
15  40     1.5   FirstProfit  53      73.6    0.08    3.96       1.29  -6.18   ‚úÖ   
16  30     1.5   FirstProfit  53      73.6    0.08    3.96       1.29  -6.18   ‚úÖ   
17  0      1.5   FirstProfit  60      73.3    0.08    4.55       1.30  -4.94   ‚úÖ   
18  50     1.2   FirstProfit  67      73.1    0.12    8.30       1.55  -4.84   ‚úÖ   
19  0      1.0   FirstProfit  106     72.6    0.12    12.98      1.56  -4.52   ‚úÖ   
20  50     1.5   FirstProfit  51      72.5    0.07    3.40       1.25  -6.18   ‚úÖ   

====================================================================================================
‚öñÔ∏è  TOP 20 - MELHOR BALANCEADO (Retorno + Expect√¢ncia + WR)
====================================================================================================
#   Body%  Size  Exit         Trades  WR%     Exp%    Ret%       PF    Score 
----------------------------------------------------------------------------------------------------
1   0      1.2   FirstProfit  82      74.4    0.16    14.12      1.81  0.933 
2   20     1.2   FirstProfit  74      74.3    0.17    13.51      1.85  0.929 
3   20     0.0   FirstProfit  226     68.6    0.07    16.34      1.40  0.911 
4   0      1.0   FirstProfit  106     72.6    0.12    12.98      1.56  0.909 
5   40     0.0   FirstProfit  192     69.8    0.08    15.21      1.43  0.908 
6   0      0.0   FirstProfit  261     66.3    0.06    16.69      1.35  0.904 
7   20     1.0   FirstProfit  96      71.9    0.12    12.24      1.57  0.901 
8   30     1.2   FirstProfit  71      74.6    0.14    9.94       1.66  0.895 
9   20     0.8   FirstProfit  138     69.6    0.09    13.33      1.43  0.895 
10  30     0.0   FirstProfit  215     68.8    0.06    13.99      1.35  0.892 
11  30     0.8   FirstProfit  133     69.9    0.09    12.45      1.42  0.889 
12  40     0.8   FirstProfit  123     72.4    0.09    11.18      1.43  0.888 
13  0      0.8   FirstProfit  156     68.6    0.08    12.59      1.36  0.883 
14  40     1.2   FirstProfit  69      73.9    0.13    8.89       1.59  0.882 
15  50     0.0   FirstProfit  167     70.1    0.07    11.45      1.35  0.877 
16  30     1.0   FirstProfit  93      72.0    0.10    9.47       1.47  0.875 
17  50     1.2   FirstProfit  67      73.1    0.12    8.30       1.55  0.874 
18  40     1.0   FirstProfit  89      71.9    0.10    8.99       1.46  0.870 
19  50     1.0   FirstProfit  84      71.4    0.10    8.40       1.44  0.864 
20  60     1.2   FirstProfit  54      74.1    0.11    5.97       1.52  0.857 

======================================================================
üéØ CONFIGURA√á√ÉO VENCEDORA 4H (Melhor Balanceada)
======================================================================
Body % m√≠nimo:          0%
Candle Size multiplier: 1.2x
Estrat√©gia de Sa√≠da:    FirstProfit

üìà RESULTADOS:
Win Rate:               74.39%
Total Trades:           82
Expect√¢ncia:            0.16% por trade
Retorno Total:          14.12%
Profit Factor:          1.81
Max Drawdown:           -4.52%
Score Composto:         0.933
Signific√¢ncia:          ‚úÖ SIM (p=0.0000)
======================================================================

======================================================================
üìä AN√ÅLISE POR ESTRAT√âGIA DE SA√çDA (M√©dias)
======================================================================
               total_trades   win_rate  expectancy_pct  total_return  profit_factor
exit_strategy                                                                      
FirstProfit       86.095238  72.421723        0.086532      7.476934       1.396175
TP1.5x            66.023810  40.860717        0.054201      2.503541       1.073526
TP1.8x            58.380952  33.558576        0.056973      2.265909       1.069986
TP2.5x            52.609756  24.455833        0.079556      1.883305       1.067658
TP1.0x            70.690476  48.872818       -0.016238     -0.445185       0.975629
TP1.2x            69.071429  43.722147       -0.016579     -0.737878       0.971261
TP3.0x            47.317073  20.344665       -0.111924     -4.286171       0.865767
TP2.0x            57.619048  26.228283       -0.088454     -4.546363       0.872643
MA_Turn           81.833333  30.315055       -0.083744     -5.730460       0.789809
None              28.842105   0.000000       -1.110062    -26.758801       0.000000

======================================================================
üèÜ EXECUTANDO BACKTEST FINAL COM CONFIGURA√á√ÉO VENCEDORA
======================================================================

======================================================================
RESULTADOS DO BACKTEST
======================================================================
Capital Inicial:      $10,000.00
Capital Final:        $11,411.53
Retorno Total:        14.12%
Expect√¢ncia/Trade:    $17.21 (0.16%)

--------------------------------TRADES--------------------------------
Total de Trades:      82
Trades Vencedores:    61 (74.4%)
Trades Perdedores:    21 (25.6%)
Win Rate IC 95%:      [64.9%, 83.8%]
Signific√¢ncia:        ‚úÖ SIM (p=0.0000)
Dura√ß√£o M√©dia:        2.7 horas
Tempo em Mercado:     5.5%

----------------------------GANHOS/PERDAS-----------------------------
Ganho M√©dio:          $51.86 (0.49%)
Perda M√©dia:          $-83.43 (-0.77%)
Maior Ganho:          $372.82 (3.62%)
Maior Perda:          $-172.42 (-1.54%)

--------------------------M√âTRICAS DE RISCO---------------------------
Max Drawdown:         -4.52%
Profit Factor:        1.81
Sharpe Ratio:         0.49
======================================================================

======================================================================
‚úÖ OTIMIZA√á√ÉO 4H CONCLU√çDA!
======================================================================

Resultados salvos em:
  ‚Ä¢ results/optimization/4h_massive_optimization.csv
